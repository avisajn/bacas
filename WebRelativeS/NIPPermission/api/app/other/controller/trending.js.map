{"version":3,"sources":["../../../src/other/controller/trending.js"],"names":["DateFormat","require","getAction","before_date","subtract","format","today","model","field","where","select","list","success","postAction","param","post","news_id","new_news_id","time","Date","fail","add","addtime","status","putAction","news_ids","length","console","log","join","update","insertId"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;;;AAFA,IAAIA,aAAaC,QAAQ,YAAR,CAAjB;;;;;;;;;;qBAKUC,S;;;;;;;AACF;AACMC,uC,GAAc,wBAASC,QAAT,CAAkB,CAAlB,EAAqB,MAArB,EAA6BC,MAA7B,CAAoC,YAApC,C;AACdC,iC,GAAQ,wBAASD,MAAT,CAAgB,YAAhB,C;AAEVE,iC,GAAQ,KAAKA,KAAL,CAAW,UAAX,C;;mCACKA,MAAMC,KAAN,CAAY,qBAAZ,EAAmCC,KAAnC,iBAAsDH,KAAtD,mCAAuFH,WAAvF,kBAAgHO,MAAhH,E;;;AAAbC,gC;6DACG,KAAKC,OAAL,CAAaD,IAAb,C;;;;;;;;;;;;;;;;;AAGX;;;qBACME,U;;;;;;;AACEC,iC,GAAQ,KAAKC,IAAL,E;AACRC,mC,GAAUF,MAAME,O,EAChBC,W,GAAcH,MAAMG,W;AAClBC,gC,GAAOlB,WAAW,IAAImB,IAAJ,EAAX,EAAuB,qBAAvB,C;;gCAETH,O;;;;;8DAAgB,KAAKI,IAAL,CAAU,CAAC,CAAX,EAAc,OAAd,C;;;AAChBb,iC,GAAQ,KAAKA,KAAL,CAAW,UAAX,C;;mCACNA,MAAMc,GAAN,CAAU,EAACL,SAAUA,OAAX,EAAoBC,aAAcA,WAAlC,EAA+CK,SAAQJ,IAAvD,EAA6DK,QAAO,CAApE,EAAV,C;;;8DACC,KAAKX,OAAL,CAAa,OAAb,C;;;;;;;;;;;;;;;;;AAIX;AACA;;;qBACMY,S;;;;;;;AACEV,iC,GAAQ,KAAKC,IAAL,E;AACRU,oC,GAAWX,MAAMW,Q;;kCAClB,CAACA,QAAD,IAAaA,SAASC,MAAT,IAAmB,C;;;;;8DACxB,KAAKN,IAAL,CAAU,CAAC,CAAX,EAAc,OAAd,C;;;AAEXO,oCAAQC,GAAR,CAAY,WAAZ,EAAwBH,QAAxB;AACIlB,iC,GAAQ,KAAKA,KAAL,CAAW,UAAX,C;;mCACSA,MAAME,KAAN,CAAY,qBAAmBgB,SAASI,IAAT,CAAc,GAAd,CAAnB,GAAsC,GAAlD,EAAuDC,MAAvD,CAA8D,EAACP,QAAO,CAAR,EAA9D,C;;;AAAjBQ,oC;8DACG,KAAKnB,OAAL,CAAa,MAAb,C","file":"trending.js","sourcesContent":["'use strict';\nlet DateFormat = require('dateformat');\nimport Base from './baserest.js';\nimport moment from 'moment';\n\nexport default class extends Base {\n    async getAction(){\n        // 查询出5天以内的trending 历史\n        const before_date = moment().subtract(5, 'days').format('YYYY-MM-DD');\n        const today = moment().format('YYYY-MM-DD');\n\n        let model = this.model('trending');\n        let list = await model.field('news_id,new_news_id').where(`addtime<='${today} 23:59:59' and addtime>='${before_date} 00:00:00'`).select();\n        return this.success(list);\n    }\n\n    // 添加一条数据\n    async postAction(){\n        let param = this.post();\n        let news_id = param.news_id,\n            new_news_id = param.new_news_id;\n        const time = DateFormat(new Date(), \"yyyy-mm-dd hh:MM:ss\")\n\n        if(!news_id){return this.fail(-1 ,'参数不正确'); }\n        let model = this.model('trending');\n        await model.add({news_id : news_id, new_news_id : new_news_id ,addtime:time ,status:0 })\n        return this.success('添加成功！');\n    }\n\n\n    // 修改一条数据\n    // 发布： 把状态改为1\n    async putAction(){\n        let param = this.post();\n        let news_ids = param.news_ids;\n        if(!news_ids && news_ids.length <= 0){\n            return this.fail(-1 ,'参数不正确');\n        }\n        console.log('news_ids,',news_ids);\n        let model = this.model('trending');\n        let insertId = await model.where('new_news_id in ('+news_ids.join(',')+')').update({status:1});\n        return this.success('修改成功');\n    }\n}"]}