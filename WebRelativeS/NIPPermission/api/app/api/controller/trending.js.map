{"version":3,"sources":["../../../src/api/controller/trending.js"],"names":["DateFormat","require","db","dbpermission","getAction","model","id","news_id","field","where","select","list","success","before_date","subtract","format","today","order","postAction","param","post","new_news_id","time","Date","fail","add","addtime","status","putAction","news_ids","ids","indexOf","split","map","k","push","join","update","insertId"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;AACA;;;;;;AAHA,IAAIA,aAAaC,QAAQ,YAAR,CAAjB;;AAIA,IAAMC,KAAK,aAAGC,YAAd;;;;;;;;;;qBAGUC,S;;;;;;;;AACEC,iC,GAAQ,KAAKA,KAAL,CAAW,UAAX,EAAsBH,EAAtB,C;;iCACT,KAAKI,E;;;;;AACEC,mC,GAAU,KAAKD,E;;mCACJD,MAAMG,KAAN,CAAY,qBAAZ,EAAmCC,KAAnC,oBAAyDF,OAAzD,sBAAkFG,MAAlF,E;;;AAAbC,gC;6DACG,KAAKC,OAAL,CAAaD,IAAb,C;;;AAEDE,uC,GAAc,wBAASC,QAAT,CAAkB,CAAlB,EAAqB,MAArB,EAA6BC,MAA7B,CAAoC,YAApC,C;AACdC,iC,GAAQ,wBAASD,MAAT,CAAgB,YAAhB,C;;mCAEGV,MAAMG,KAAN,CAAY,qBAAZ,EAAmCS,KAAnC,CAAyC,SAAzC,EAAoDR,KAApD,iBAAuEO,KAAvE,mCAAwGH,WAAxG,+BAA8IH,MAA9I,E;;;AAAbC,iC;6DACG,KAAKC,OAAL,CAAaD,KAAb,C;;;;;;;;;;;;;;;;;AAKf;;;qBACMO,U;;;;;;;AACEC,iC,GAAQ,KAAKC,IAAL,E;AACRb,mC,GAAUY,MAAMZ,O,EAChBc,W,GAAcF,MAAME,W;AAClBC,gC,GAAOtB,WAAW,IAAIuB,IAAJ,EAAX,EAAuB,qBAAvB,C;;gCAEThB,O;;;;;8DAAgB,KAAKiB,IAAL,CAAU,CAAC,CAAX,EAAc,OAAd,C;;;AAChBnB,iC,GAAQ,KAAKA,KAAL,CAAW,UAAX,EAAsBH,EAAtB,C;;mCACNG,MAAMoB,GAAN,CAAU,EAAClB,SAAUA,OAAX,EAAoBc,aAAcA,WAAlC,EAA+CK,SAAQJ,IAAvD,EAA6DK,QAAO,CAApE,EAAV,C;;;8DACC,KAAKf,OAAL,CAAa,OAAb,C;;;;;;;;;;;;;;;;;AAIX;AACA;;;qBACMgB,S;;;;;;;AACET,iC,GAAQ,KAAKC,IAAL,E;AACRS,oC,GAAWV,MAAM,UAAN,C;;gCACXU,Q;;;;;8DACO,KAAKL,IAAL,CAAU,CAAC,CAAX,EAAc,OAAd,C;;;AAEPM,+B,GAAM,E;;AACV,gCAAGD,SAASE,OAAT,CAAiB,GAAjB,IAAwB,CAA3B,EAA6B;AACzBF,2CAAWA,SAASG,KAAT,CAAe,GAAf,CAAX;AACAH,yCAASI,GAAT,CAAa,UAACC,CAAD,EAAO;AAChBJ,wCAAIK,IAAJ,CAAS,MAAID,CAAJ,GAAM,GAAf;AACH,iCAFD;AAGH,6BALD,MAKK;AACDJ,oCAAIK,IAAJ,CAAS,MAAIN,QAAJ,GAAa,GAAtB;AACH;AACGxB,iC,GAAQ,KAAKA,KAAL,CAAW,UAAX,EAAsBH,EAAtB,C;;mCACSG,MAAMI,KAAN,CAAY,qBAAmBqB,IAAIM,IAAJ,CAAS,GAAT,CAAnB,GAAiC,GAA7C,EAAkDC,MAAlD,CAAyD,EAACV,QAAO,CAAR,EAAzD,C;;;AAAjBW,oC;8DACG,KAAK1B,OAAL,CAAa,MAAb,C","file":"trending.js","sourcesContent":["'use strict';\nlet DateFormat = require('dateformat');\nimport Base from './baserestnone.js';\nimport moment from 'moment';\nimport DB from '../../db.js';\nconst db = DB.dbpermission;\n\nexport default class extends Base {\n    async getAction(){\n        let model = this.model('trending',db);\n        if(this.id){\n            const news_id = this.id;\n            let list = await model.field('news_id,new_news_id').where(`new_news_id='${news_id}' and status=1`).select();\n            return this.success(list);\n        }else{\n            const before_date = moment().subtract(5, 'days').format('YYYY-MM-DD');\n            const today = moment().format('YYYY-MM-DD');\n\n            let list = await model.field('news_id,new_news_id').order('id desc').where(`addtime<='${today} 23:59:59' and addtime>='${before_date} 00:00:00' and status=1`).select();\n            return this.success(list);\n        }\n        \n    }\n\n    // 添加一条数据\n    async postAction(){\n        let param = this.post();\n        let news_id = param.news_id,\n            new_news_id = param.new_news_id;\n        const time = DateFormat(new Date(), \"yyyy-mm-dd hh:MM:ss\")\n\n        if(!news_id){return this.fail(-1 ,'参数不正确'); }\n        let model = this.model('trending',db);\n        await model.add({news_id : news_id, new_news_id : new_news_id ,addtime:time ,status:0 })\n        return this.success('添加成功！');\n    }\n\n\n    // 修改一条数据\n    // 发布： 把状态改为1\n    async putAction(){\n        let param = this.post();\n        let news_ids = param['news_ids'];\n        if(!news_ids){\n            return this.fail(-1 ,'参数不正确');\n        }\n        let ids = [];\n        if(news_ids.indexOf('-') > 0){\n            news_ids = news_ids.split('-');\n            news_ids.map((k) => {\n                ids.push(\"'\"+k+\"'\");\n            })\n        }else{\n            ids.push(\"'\"+news_ids+\"'\");\n        }\n        let model = this.model('trending',db);\n        let insertId = await model.where('new_news_id in ('+ids.join(',')+')').update({status:1});\n        return this.success('修改成功');\n    }\n}"]}