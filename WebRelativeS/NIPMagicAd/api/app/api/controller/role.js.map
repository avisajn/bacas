{"version":3,"sources":["../../../src/api/controller/role.js"],"names":["UID","require","DateFormat","getAction","id","roleId","model","field","where","roleid","select","list","resObj","_id","map","k","sysid","push","sysinfoid","success","params","get","key","current","rowCount","page","count","postAction","param","post","name","time","Date","fail","add","desc","putAction","update","insertId","deleteAction","uid","delete"],"mappings":"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","file":"role.js","sourcesContent":["'use strict';\nlet UID = require('node-uuid');\nlet DateFormat = require('dateformat');\nimport Base from './baserest.js';\n\nexport default class extends Base {\n    async getAction(){\n        //获取信息\n        if(this.id){\n            let roleId = this.id;\n            let model = this.model('rolesys');\n            let list = await model.field('sysid,sysinfoid').where({roleid:roleId}).select();\n            let resObj = {};\n            let _id = null;\n            list.map((k) => {\n                _id = k.sysid;\n                if(!resObj[_id]){\n                    resObj[_id] = [];\n                }\n                resObj[_id].push(k.sysinfoid+\"\");\n            })\n            return this.success(resObj);\n        }\n        // 获取列表\n        else{\n\n            let params      = this.get() || {},\n                key         = params.key,\n                current     = params.current || 1,\n                rowCount    = params.rowCount || 10;\n\n            let where = {}\n            // let where = {'adduser': this.getUserId() }\n            if (key) { where['name'] = ['like', '%' + key + '%']; }\n\n            let model = this.model('role');\n            let list = await model.field('id,name,desc').page(current, rowCount).where(where).select();\n\n            let count = await model.where(where).count('id');\n            return this.success({\n              \"current\": current,\n              \"rowCount\": rowCount,\n              \"rows\": list,\n              \"total\": count\n            });\n        }\n    }\n\n    // 添加一条数据\n    async postAction(){\n        let param = this.post();\n        let name = param.name,\n            time = DateFormat(new Date(), \"yyyy-mm-dd hh:MM:ss\");\n\n        if(!name){\n            return this.fail(-1 ,'参数不正确');\n        }\n        let model = this.model('role');\n        await model.add({\n            name : name,\n            desc : param.desc || '',\n        })\n        return this.success('添加成功！');\n    }\n\n    // 修改一条数据\n    async putAction(){\n        if(!this.id){\n            return this.fail('id为空！');\n        }\n\n        let param = this.post();\n        let id = param.id, name = param.name;\n        if(!name){\n            return this.fail(-1 ,'参数不正确');\n        }\n        let model = this.model('role');\n\n        let insertId = await model.where({id: id }).update({\n            name : name,\n            desc : param.desc || '',\n        });\n        return this.success('修改成功');\n    }\n\n    async deleteAction(){\n        let uid = this.id;\n        if (!uid) return this.fail('id为空！');\n        let model = this.model('role');\n        await model.delete({where: {id: uid } });\n        return this.success('删除成功！');\n    }\n}"]}