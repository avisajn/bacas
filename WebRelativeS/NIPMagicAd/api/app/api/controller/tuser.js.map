{"version":3,"sources":["../../../src/api/controller/tuser.js"],"names":["csv","require","db","permisson","getAction","model","field","where","select","data","content","map","k","i","sex","card","json","saveuserAction","param","post","name","fail","add","email","birthdate","phone","platform","city","id","success"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,IAAIA,MAAMC,QAAQ,KAAR,CAAV;;AAEA,IAAMC,KAAK,aAAGC,SAAd;;;;;;;;;;AAGI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;qBACMC,S;;;;;;;AACIC,iC,GAAQ,KAAKA,KAAL,CAAW,YAAX,EAAyBH,EAAzB,C;;mCACKG,MAAMC,KAAN,CAAY,2DAAZ,EAAyEC,KAAzE,CAA+E,uBAA/E,EAAwGC,MAAxG,E;;;AAAbC,gC;;;AAGN;AACA;AACA;AACA;AACA;AACA;;AAEMC,mC,GAAU,E;;;AAEhBD,iCAAKE,GAAL,CAAS,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACfD,kCAAEE,GAAF,GAAQF,EAAEE,GAAF,IAAS,GAAT,GAAe,MAAf,GAAwB,QAAhC;AACAF,kCAAEG,IAAF,GAASH,EAAEG,IAAF,IAAU,GAAV,GAAgB,KAAhB,GAAwB,IAAjC;AACA;AACA;AACH,6BALD;AAMA;AACA,iCAAKC,IAAL,CAAUP,IAAV;;;;;;;;;;;;;;;;;AAKJ;;;qBACMQ,c;;;;;;;AACEC,iC,GAAQ,KAAKC,IAAL,E;AACRC,gC,GAAOF,MAAME,I;;kCACd,CAACF,MAAM,OAAN,CAAD,IAAmB,CAACA,MAAM,MAAN,CAApB,IAAqC,CAACA,MAAM,OAAN,CAAtC,IAAwD,CAACA,MAAM,WAAN,CAAzD,IAA+E,CAACA,MAAM,MAAN,C;;;;;8DACxE,KAAKG,IAAL,CAAU,CAAC,CAAX,EAAc,OAAd,C;;;AAEPhB,iC,GAAQ,KAAKA,KAAL,CAAW,YAAX,EAAyBH,EAAzB,C;;mCACKG,MAAMiB,GAAN,CAAU;AACvBC,uCAAQL,MAAM,OAAN,CADe;AAEvBE,sCAAOF,MAAM,MAAN,CAFgB;AAGvBM,2CAAYN,MAAM,WAAN,CAHW;AAIvBO,uCAAQP,MAAM,OAAN,CAJe;AAKvBH,sCAAOG,MAAM,MAAN,CALgB;AAMvBQ,0CAAWR,MAAM,UAAN,CANY;AAOvBS,sCAAOT,MAAM,MAAN,CAPgB;AAQvBJ,qCAAMI,MAAM,KAAN;AARiB,6BAAV,C;;;AAAXU,8B;;iCAUHA,E;;;;;8DACQ,KAAKC,OAAL,CAAaD,EAAb,C;;;8DAEA,KAAKP,IAAL,CAAU,CAAC,CAAX,EAAcO,EAAd,C","file":"tuser.js","sourcesContent":["'use strict';\nimport azure from 'azure-storage';\nimport moment from 'moment';\nimport Base from './base.js';\nimport DB from '../../db.js';\nimport fs from 'fs';\nvar csv = require('csv');\n\nconst db = DB.permisson;\n\nexport default class extends Base {\n    // // 返回处理后的列表\n    // async getadunitAction(){\n    //     const model = this.model('adunit' ,db);\n    //     const data = await model.field('id,name,creative_ratio,creative_size_limitation').where({app:'baca'}).select();\n    //     // data.map((k) => {\n    //     //     k.name = k.name+'_'+(parseInt(k.index)+1);\n    //     //     delete k.index;\n    //     // })\n    //     return this.success(data);\n    // }\n\n    // 返回所有的发布人\n    async getAction(){\n        const model = this.model('temp_users' ,db);\n        const data = await model.field('email,name,birthdate,phone,card,city,sex,addtime,platform').where(\"email not like '%12%'\").select();\n        \n\n        // const fileName= \"data.xls\";\n        // const _http = this.http;\n        // _http.header('Content-Type', 'application/vnd.ms-execl');\n        // _http.header('Content-Disposition', \"attachment;filename=\"+encodeURIComponent(fileName));\n        // _http.header('Pragma', 'no-cache');\n        // _http.header('Expires', 0);\n\n        const content = [];\n\n        data.map((k ,i) => {\n            k.sex = k.sex == '1' ? 'male' : 'female';\n            k.card = k.card == '1' ? 'yes' : 'no';\n            // if(i == 0){ content.push(`email\\tname\\tbirthdate\\tphone\\tcard\\tcity\\tsex`); }\n            // content.push(`${k.email}\\t${k.name}\\t${k.birthdate}\\t${k.phone}\\t${k.card}\\t${k.city}\\t${k.sex}`);\n        })\n        // _http.write(content.join('\\n'));\n        this.json(data);\n    }\n\n\n\n    // 返回所有的发布人\n    async saveuserAction(){\n        let param = this.post();\n        let name = param.name;\n        if(!param['email'] || !param['name'] || !param['phone'] || !param['birthdate'] || !param['city']){\n            return this.fail(-1 ,'参数不正确');\n        }\n        let model = this.model('temp_users' ,db);\n        const id = await model.add({\n            email : param['email'],\n            name : param['name'],\n            birthdate : param['birthdate'],\n            phone : param['phone'],\n            card : param['card'],\n            platform : param['platform'],\n            city : param['city'],\n            sex : param['sex'],\n        })\n        if(id){\n            return this.success(id);\n        }else{\n            return this.fail(-1 ,id);\n        }\n    }\n\n}   "]}