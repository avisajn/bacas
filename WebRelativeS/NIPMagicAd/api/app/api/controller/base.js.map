{"version":3,"sources":["../../../src/api/controller/base.js"],"names":["__before","allowAccessOrigin","http","headers","origin","header","method","toLocaleLowerCase","allow","end","think","controller","base"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;;;;AAGE;;;mBAGMA,Q;;;;;;;AAEAC,+B,GAAoB,KAAKC,IAAL,CAAUC,OAAV,CAAkBC,M;;AAC1C,mBAAKC,MAAL,CAAY,6BAAZ,EAA2CJ,iBAA3C;AACA;AACA,mBAAKI,MAAL,CAAY,8BAAZ,EAA4C,mGAA5C;AACA,mBAAKA,MAAL,CAAY,8BAAZ,EAA4C,iCAA5C;AACA,mBAAKA,MAAL,CAAY,kCAAZ,EAAgD,MAAhD;AACMC,oB,GAAS,KAAKJ,IAAL,CAAUI,MAAV,CAAiBC,iBAAjB,E;;AACf,mBAAKD,MAAL,GAAcA,MAAd;;oBACGA,UAAU,S;;;;;AACX,mBAAKE,KAAL,GAAa,KAAb;AACA,mBAAKC,GAAL;;;;;;;;;;;;;;;;;;;EAhBuBC,MAAMC,UAAN,CAAiBC,I","file":"base.js","sourcesContent":["'use strict';\n\nimport {decryptCode} from '../../util.js';\n\nexport default class extends think.controller.base {\n  /**\n   * some base method in here\n   */\n  async __before() {\n\n    let allowAccessOrigin = this.http.headers.origin;\n    this.header('Access-Control-Allow-Origin', allowAccessOrigin);\n    // this.header('Access-Control-Allow-Headers', 'Content-Type,Content-Length, Authorization, Accept,X-Requested-With, enctype');\n    this.header('Access-Control-Allow-Headers', 'Content-Type,Content-Length, Authorization, Accept ,X-Requested-With,uk,enctype,document,location');\n    this.header('Access-Control-Allow-Methods', \"GET, POST, PUT, DELETE, OPTIONS\");\n    this.header('Access-Control-Allow-Credentials', 'true');\n    const method = this.http.method.toLocaleLowerCase();\n    this.method = method;\n    if(method == \"options\"){\n      this.allow = false;\n      this.end();\n      return;\n    }\n    \n    // let ciphertext = this.cookie(\"token\");\n    // if(!ciphertext || ciphertext == '0'){\n    //   return this.fail(-99);\n    // }\n\n\n    // const platform = {\n    //   'app.ios'       : true,\n    //   'app.android'   : true,\n    //   'web'           : true,\n    // }\n\n    // const decryptedData = decryptCode(ciphertext);\n    // // 必须传入过期时间 和 modulename  \n    // // 事例 \n    // // {\n    // //    time -> 过期时间  [后期会被用到]\n    // //    platform -> 平台 [app.ios | app.android]\n    // // }\n    // if(!decryptedData || !decryptedData.platform || !platform[decryptedData.platform]){\n    //   return this.fail(-99);\n    // }\n\n    // if(new Date().getTime() >= decryptedData.time){\n    //   return this.fail(-98);\n    // }\n    // let _userInfo = decryptedData;\n    // this.getUser = function(){\n    //   return _userInfo;\n    // }\n\n    // this.getRids = function(){\n    //   return _userInfo.roleids;\n    // }\n\n    // this.getUserId = function(){\n    //     return _userInfo.id;\n    // }\n  }\n}"]}