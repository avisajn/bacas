{
    "version": 3,
    "sources": [
        "../../../src/json/controller/offer.js"
    ],
    "names": [
        "container",
        "cdnHost",
        "id",
        "br",
        "db",
        "dbmagicad",
        "blobService",
        "createBlobService",
        "fileService",
        "createFileService",
        "renameFile",
        "tmp_path",
        "target_path",
        "r",
        "f",
        "rename",
        "err",
        "unlink",
        "getFile",
        "name",
        "file_path",
        "think",
        "RUNTIME_PATH",
        "getBlobToStream",
        "createWriteStream",
        "error",
        "result",
        "response",
        "console",
        "log",
        "uploadImage",
        "country",
        "createBlockBlobFromLocalFile",
        "isSuccessful",
        "url",
        "getAction",
        "success",
        "uploadimageAction",
        "http",
        "method",
        "fail",
        "param",
        "post",
        "start",
        "end",
        "title",
        "file",
        "_file",
        "path",
        "oldName",
        "originalFilename",
        "ext",
        "substring",
        "lastIndexOf"
    ],
    "mappings": "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",
    "file": "../../../src/json/controller/offer.js",
    "sourcesContent": [
        "'use strict';\nimport azure from 'azure-storage';\nimport moment from 'moment';\nimport Base from './base.js';\nimport DB from '../../db.js';\nimport fs from 'fs';\n\n\nconst container = 'test';\nconst cdnHost = {\n    id : 'http://img.cdn.baca.co.id/',\n    br : 'http://img.cdn.baca.co.id/'\n}\n\n\nconst db = DB.dbmagicad;\n\nconst blobService = azure.createBlobService('nipcleantool', '7kAN5quppIjeVs5KvAtC1UXcP1UBwgWJzIvWXNtosa4ZYf7Z20jmVncM8VaQtGGJPjfCivzvnIBN41BZfYjYQg==');\n\n\nconst fileService = azure.createFileService('nipcleantool', '7kAN5quppIjeVs5KvAtC1UXcP1UBwgWJzIvWXNtosa4ZYf7Z20jmVncM8VaQtGGJPjfCivzvnIBN41BZfYjYQg==');\n\n\nconst renameFile = function(tmp_path ,target_path){\n    return new Promise((r ,f) => {\n        // // 移动文件\n        fs.rename(tmp_path, target_path, function(err) {\n            if (err) throw err;\n            // 删除临时文件夹文件, \n            fs.unlink(tmp_path, function() {\n                if (err) throw err;  \n                r();\n            });\n        });\n    })\n},\n\ngetFile = function(name){\n    let file_path = think.RUNTIME_PATH + '/upload/'+name ;\n    return new Promise((r ,f) => {\n        blobService.getBlobToStream(container, name, fs.createWriteStream(file_path), function(error, result, response) {\n            console.log('error' ,error);\n            console.log('error' ,result);\n          if (!error) {\n            // blob retrieved\n          }\n        });\n    })\n\n},\n\n\nuploadImage = function(name ,country){\n    let file_path = think.RUNTIME_PATH + '/upload/' + name;\n    return new Promise((r ,f) => {\n        blobService.createBlockBlobFromLocalFile(container, 'ads/'+name, file_path , function(error, result, response) {\n            if (error || !response.isSuccessful) {r({error}); return; }\n            r({error ,url:cdnHost[country] + 'ads/'+name});\n        });\n    })\n\n}\n\n\nexport default class extends Base {\n    // 返回处理后的列表\n    async getAction(){\n        getFile('adconfig_goclean.json');\n        return this.success('1231');\n    }\n\n\n    async uploadimageAction(){\n        // 参考 https://github.com/Azure/azure-storage-node\n        if(this.http.method!='POST'){\n            return this.fail(-1);\n        }\n\n        let param = this.post(),\n            start = param.start ,\n            end = param.end,\n            title = param.title;\n\n        let file = this.http._file[0];\n\n        if(!file || !start || !end || !title){\n            return this.fail(-1 ,'参数错误！');\n        }\n\n        let tmp_path = file.path,\n            oldName = file.originalFilename,\n            ext  = oldName.substring(oldName.lastIndexOf('.'));\n\n        let name = title+\"_\"+start+\"_\"+end+ext;\n\n        let target_path = think.RUNTIME_PATH + '/upload/' + name;\n\n        await renameFile(tmp_path ,target_path);\n\n\n        const {error ,url} = await uploadImage(name ,'id');\n        if(error){\n            return this.fail(-1 ,'上传错误！'+JSON.stringify(error));\n        }\n        return this.success(url);\n    }\n\n\n\n}   "
    ]
}