{"version":3,"sources":["../../../src/activity/controller/base.js"],"names":["Base64","require","__before","allow","allowAccessOrigin","http","headers","origin","isAllow","think","env","i","len","length","indexOf","header","method","toLocaleLowerCase","end","controller","base"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA,IAAIA,SAASC,QAAQ,WAAR,EAAqBD,MAAlC;;;;;;;;;;AAGE;;;mBAGME,Q;;;;;;;AAEEC,mB,GAAQ,CAAC,kBAAD,EAAqB,WAArB,EAAkC,uBAAlC,EAA2D,iCAA3D,C;AAEVC,+B,GAAoB,KAAKC,IAAL,CAAUC,OAAV,CAAkBC,M;AACtCC,qB,GAAU,K;;AACd,kBAAGC,MAAMC,GAAN,IAAa,aAAhB,EAA+BF,UAAU,IAAV;AAC/B;;AAEQG,e,GAAE,C,EAAEC,G,GAAIT,MAAMU,M;;;oBAAOF,IAAEC,G;;;;;mBACxBJ,O;;;;;;;;AACH,kBAAGJ,qBAAqBA,kBAAkBU,OAAlB,CAA0BX,MAAMQ,CAAN,CAA1B,KAAuC,CAA/D,EAAkEH,UAAU,IAAV;;;AAFnCG,iB;;;;;AAInC;AACA;;AAEA,kBAAGH,OAAH,EAAW;AACP,qBAAKO,MAAL,CAAY,6BAAZ,EAA2CX,iBAA3C;AACH,eAFD,MAEK;AACD,qBAAKW,MAAL,CAAY,6BAAZ,EAA2C,kBAA3C;AACH;AACD,mBAAKA,MAAL,CAAY,8BAAZ,EAA4C,mGAA5C;AACA,mBAAKA,MAAL,CAAY,8BAAZ,EAA4C,iCAA5C;AACA,mBAAKA,MAAL,CAAY,kCAAZ,EAAgD,MAAhD;AACMC,oB,GAAS,KAAKX,IAAL,CAAUW,MAAV,CAAiBC,iBAAjB,E;;AACf,mBAAKD,MAAL,GAAcA,MAAd;;oBACGA,UAAU,S;;;;;AACX,mBAAKb,KAAL,GAAa,KAAb;AACA,mBAAKe,GAAL;;;;AAGF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAKf,KAAL,GAAaK,OAAb;;;;;;;;;;;;;;;;;;EA9DyBC,MAAMU,UAAN,CAAiBC,I","file":"base.js","sourcesContent":["'use strict';\n\nimport {decryptCode} from '../../util.js';\nvar Base64 = require('js-base64').Base64;\n\nexport default class extends think.controller.base {\n  /**\n   * some base method in here\n   */\n  async __before() {\n\n    const allow = ['event.baca.co.id' ,'localhost' ,'event.cennoticias.com' ,'event.festival.8jiajia.ymark.cc']\n\n    let allowAccessOrigin = this.http.headers.origin;\n    let isAllow = false;\n    if(think.env == 'development') isAllow = true;\n    // console.log('all-1;',isAllow);\n\n    for(let i=0,len=allow.length;i<len;i++){\n        if(isAllow) break;\n        if(allowAccessOrigin && allowAccessOrigin.indexOf(allow[i]) >= 0) isAllow = true;\n    }\n    // console.log('all-2;',isAllow);\n    // console.log('all-2-1;',allowAccessOrigin);\n\n    if(isAllow){\n        this.header('Access-Control-Allow-Origin', allowAccessOrigin);\n    }else{\n        this.header('Access-Control-Allow-Origin', 'event.baca.co.id');\n    }\n    this.header('Access-Control-Allow-Headers', 'Content-Type,Content-Length, Authorization, Accept ,X-Requested-With,uk,enctype,document,location');\n    this.header('Access-Control-Allow-Methods', \"GET, POST, PUT, DELETE, OPTIONS\");\n    this.header('Access-Control-Allow-Credentials', 'true');\n    const method = this.http.method.toLocaleLowerCase();\n    this.method = method;\n    if(method == \"options\"){\n      this.allow = false;\n      this.end();\n      return;\n    }\n    // console.log('all-3;',isAllow ,method);    \n    // 判断\n\n    // let ciphertext = this.cookie(\"token\");\n    // let ciphertext = this.http.headers['uk'];\n    // ciphertext = Base64.decode(ciphertext || '');\n    \n    // if(isAllow && ciphertext && ciphertext != '0'){\n    //   this.uk = ciphertext;\n    //   // return this.fail(-99);\n    //     const decryptedData = decryptCode(ciphertext);\n    //     // 必须传入过期时间 和 modulename  \n    //     // 事例 \n    //     // {\n    //     //    time -> 过期时间  [后期会被用到]\n    //     // }\n    //     if(decryptedData){\n    //         if(!decryptedData.key){\n    //           this.allow = false;\n    //         }else{\n    //           this.allow = true;\n    //         }\n    //     }\n    // }else{\n    //   this.allow = false;\n    // }\n\n    this.allow = isAllow;\n\n  }\n}"]}