{
    "version": 3,
    "sources": [
        "../../../src/activity/controller/_img.js"
    ],
    "names": [
        "co",
        "require",
        "OSS",
        "ALIConfig",
        "region",
        "client",
        "renameFile",
        "tmp_path",
        "target_path",
        "r",
        "f",
        "rename",
        "err",
        "unlink",
        "removeFile",
        "path",
        "uploadImage",
        "file_path",
        "real_name",
        "useBucket",
        "put",
        "result",
        "url",
        "catch",
        "uploadimgAction",
        "allow",
        "fail",
        "http",
        "method",
        "toLocaleLowerCase",
        "params",
        "post",
        "mbname",
        "name",
        "param",
        "file",
        "_file",
        "oldName",
        "Date",
        "getTime",
        "parseInt",
        "Math",
        "random",
        "type",
        "headers",
        "ext",
        "link_name",
        "replace",
        "success"
    ],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,KAAKC,QAAQ,IAAR,CAAX;AACA,IAAMC,MAAMD,QAAQ,SAAR,CAAZ;AACAE,UAAUC,MAAV,GAAmB,iBAAnB;AACA,IAAMC,SAAS,IAAIH,GAAJ,CAAQC,SAAR,CAAf;;AAEA,IAAMG,aAAa,SAAbA,UAAa,CAASC,QAAT,EAAmBC,WAAnB,EAA+B;AAC9C,WAAO,sBAAY,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACzB;AACA,qBAAGC,MAAH,CAAUJ,QAAV,EAAoBC,WAApB,EAAiC,UAASI,GAAT,EAAc;AAC3C,gBAAIA,GAAJ,EAAS,MAAMA,GAAN;AACT;AACA,yBAAGC,MAAH,CAAUN,QAAV,EAAoB,YAAW;AAC3B,oBAAIK,GAAJ,EAAS,MAAMA,GAAN;AACTH;AACH,aAHD;AAIH,SAPD;AAQH,KAVM,CAAP;AAWH,CAZD;AAAA,IAcAK,aAAa,SAAbA,UAAa,CAASC,IAAT,EAAc;AACvB,WAAO,sBAAY,UAACN,CAAD,EAAIC,CAAJ,EAAU;AACzB,qBAAGG,MAAH,CAAUE,IAAV,EAAgB,UAASH,GAAT,EAAc;AAC1B,gBAAIA,GAAJ,EAAS,MAAMA,GAAN;AACTH;AACH,SAHD;AAIH,KALM,CAAP;AAMH,CArBD;AAAA,IAuBAO,cAAc,SAAdA,WAAc,CAASC,SAAT,EAAoBC,SAApB,EAA8B;AACxC,WAAO,sBAAY,UAACT,CAAD,EAAIC,CAAJ,EAAU;AACzBV,sCAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AACDK,mCAAOc,SAAP,CAAiB,cAAjB;AADC;AAAA,mCAEkBd,OAAOe,GAAP,CAAW,kBAAgBF,SAA3B,EAAsCD,SAAtC,CAFlB;;AAAA;AAEGI,kCAFH;;AAGDZ,8BAAEY,OAAOC,GAAT;;AAHC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAH,GAIGC,KAJH,CAIS,UAAUX,GAAV,EAAe;AACtBH;AACD,SAND;AAOH,KARM,CAAP;AAUH,CAlCD;;;;;;;;;;qBAwCUe,e;;;;;;;gCACE,KAAKC,K;;;;;8DAAe,KAAKC,IAAL,CAAU,CAAC,CAAX,EAAc,WAAd,C;;;kCACrB,KAAKC,IAAL,CAAUC,MAAV,CAAiBC,iBAAjB,MAAwC,M;;;;;8DAAgB,KAAKH,IAAL,CAAU,CAAC,CAAX,EAAc,MAAd,C;;;AACvDI,kC,GAAc,KAAKC,IAAL,MAAe,E,EAC7BC,M,GAAcF,OAAOG,I;;gCAErBD,M;;;;;8DAAe,KAAKN,IAAL,CAAU,CAAC,CAAX,EAAc,MAAd,C;;;AAEfQ,iC,GAAQ,KAAKH,IAAL,E;AACRI,gC,GAAO,KAAKR,IAAL,CAAUS,KAAV,CAAgB,CAAhB,C;AAEP7B,oC,GAAW4B,KAAKpB,I,EAChBsB,O,GAAU,IAAIC,IAAJ,GAAWC,OAAX,KAAqB,EAArB,GAAwBC,SAASC,KAAKC,MAAL,KAAc,IAAvB,C,EAClCC,I,GAAOR,KAAKS,OAAL,CAAa,cAAb,C,EACPC,G,GAAO,M;AAEPZ,gC,GAAOI,UAAQQ,G;;mCAEG7B,YAAYT,QAAZ,EAAsB0B,IAAtB,C;;;AAAlBa,qC;;gCACAA,S;;;;;8DAAkB,KAAKpB,IAAL,CAAU,CAAC,CAAX,EAAc,OAAd,C;;;AACtBoB,wCAAYA,UAAUC,OAAV,CAAkB,2CAAlB,EAA+D,cAA/D,CAAZ;;mCACMjC,WAAWN,WAAX,C;;;8DACC,KAAKwC,OAAL,CAAaF,SAAb,C",
    "file": "../../../src/activity/controller/_img.js",
    "sourcesContent": [
        "'use strict';\nimport azure from 'azure-storage';\nimport moment from 'moment';\nimport Base from './basemy.js';\nimport fs from 'fs';\n\nconst co = require('co');\nconst OSS = require('ali-oss');\nALIConfig.region = 'oss-cn-shanghai';\nconst client = new OSS(ALIConfig);\n\nconst renameFile = function(tmp_path ,target_path){\n    return new Promise((r ,f) => {\n        // // 移动文件\n        fs.rename(tmp_path, target_path, function(err) {\n            if (err) throw err;\n            // 删除临时文件夹文件, \n            fs.unlink(tmp_path, function() {\n                if (err) throw err;  \n                r();\n            });\n        });\n    })\n},\n\nremoveFile = function(path){\n    return new Promise((r ,f) => {\n        fs.unlink(path, function(err) {\n            if (err) throw err;  \n            r();\n        });\n    })\n},\n\nuploadImage = function(file_path ,real_name){\n    return new Promise((r ,f) => {\n        co(function* () {\n          client.useBucket('ymark-public');\n          var result = yield client.put('yixiaotu/tmp/'+real_name, file_path);\n          r(result.url);\n        }).catch(function (err) {\n          r();\n        });\n    })\n\n};\n\n\n\nexport default class extends Base {\n\n    async uploadimgAction(){\n        if(!this.allow) {return this.fail(-1 ,'not allow');  }\n        if(this.http.method.toLocaleLowerCase() != 'post') {return this.fail(-1 ,'参数错误') ; }\n        let params      = this.post() || {},\n            mbname      = params.name;\n\n        if(!mbname) return this.fail(-1 ,'参数错误');\n\n        let param = this.post();\n        let file = this.http._file[0];\n\n        let tmp_path = file.path,\n            oldName = new Date().getTime()+\"\"+parseInt(Math.random()*1000),\n            type = file.headers['content-type'],\n            ext  = '.png';\n\n        let name = oldName+ext;\n\n        let link_name = await uploadImage(tmp_path ,name);\n        if(!link_name) return this.fail(-1 ,'上传错误！');\n        link_name = link_name.replace('ymark-public.oss-cn-shanghai.aliyuncs.com' ,'oss.ymark.cc');\n        await removeFile(target_path);\n        return this.success(link_name);\n        \n    }\n\n\n}   "
    ]
}