{"version":3,"sources":["../../../src/activity/controller/jj.js"],"names":["db","activity","subAction","allow","method","fail","post","name","phone","res","type","myreg","test","model_user","model","where","select","num","length","success","id","err","add","new_id","getAction","get","user","substring","countAction","field","old_num","new_num"],"mappings":"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","file":"jj.js","sourcesContent":["'use strict';\nimport moment from 'moment';\nimport Base from './base.js';\nimport DB from '../../db.js';\n\nconst db = DB.activity;\n\nexport default class extends Base {\n\n    // 提交信息\n    async subAction(){\n        if(!this.allow || this.method!='post') return this.fail(-1 ,'not allow');\n        let { \n            name ,  // 姓名\n            phone , // 手机号\n            res,    // 答题结果\n            type,   // 1:旧 ，2:新\n        } = this.post();\n\n        if(!name||!phone||!type||!res) return this.fail(-1,'参数错误！');\n        const myreg = /^1\\d{10}$/;\n        if(!myreg.test(phone)) return this.fail(-1,'手机号错误！');\n        let model_user = this.model('jiajia_user' ,db);\n        \n        let num = await model_user.where(`phone='${phone}'`).select();\n        if(num.length > 0) return this.success({id:num[0].id, err:'重复添加'});\n\n        // 向记录表中插入一条记录\n        let new_id = await model_user.add({\n            name : name, // 发起用户姓名\n            phone : phone,\n            res : res,\n            type : type\n        });\n        return this.success({id:new_id});\n\n    }\n\n    // 提交信息\n    async getAction(){\n        if(!this.allow || this.method!='get') return this.fail(-1 ,'not allow');\n        let { \n            phone , // 手机号\n        } = this.get();\n\n        if(!phone) return this.fail(-1,'参数错误！');\n        const myreg = /^1\\d{10}$/;\n        if(!myreg.test(phone)) return this.fail(-1,'手机号错误！');\n        let model_user = this.model('jiajia_user' ,db);\n        let num = await model_user.where(`phone='${phone}'`).select();\n        if(num.length <= 0) return this.fail(-2,'找不到！');\n        let user = num[0];\n        user.phone = user.phone.substring(0,3)+' **** '+user.phone.substring(user.phone.length-4);\n        return this.success({name:user.name, phone:user.phone ,type:user.type});\n    }\n\n    async countAction(){\n        let model_user = this.model('jiajia_user' ,db);\n        let old_num = await model_user.field('id').where('type=1').select();\n        old_num = old_num.length;\n        let new_num = await model_user.field('id').where('type=2').select();\n        new_num = new_num.length;\n        return this.success(`一共有${new_num+old_num}个用户参加，其中${new_num}个是新用户，${old_num}个是老用户`);\n    }\n\n}   "]}