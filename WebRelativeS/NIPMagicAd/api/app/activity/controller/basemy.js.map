{"version":3,"sources":["../../../src/activity/controller/basemy.js"],"names":["__before","allow","http","headers","origin","uk","ip","isAllow","think","env","i","len","length","indexOf","header","method","end","controller","base"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;;;;AAGE;;;mBAGMA,Q;;;;;;;;AACEC,mB,GAAQ,CAAC,UAAD,EAAa,WAAb,EAA0B,eAA1B,C;8BAEa,KAAKC,IAAL,CAAUC,O;mDAA/BC,M;AAAAA,oB,wCAAO,E;+CAAIC,E;AAAAA,gB,oCAAG,E;;;AAEpB,mBAAKC,EAAL,GAAU,KAAKJ,IAAL,CAAUI,EAAV,EAAV;;AAEIC,qB,GAAU,K;;AACd,kBAAGC,MAAMC,GAAN,IAAa,aAAb,IAA8BJ,MAAM,gBAAvC,EAAyDE,UAAU,IAAV;;AAEjDG,e,GAAE,C,EAAEC,G,GAAIV,MAAMW,M;;;oBAAOF,IAAEC,G;;;;;mBACxBJ,O;;;;;;;;AACH,kBAAGH,UAAUA,OAAOS,OAAP,CAAeZ,MAAMS,CAAN,CAAf,KAA4B,CAAzC,EAA4CH,UAAU,IAAV;;;AAFbG,iB;;;;;;AAKnC,kBAAGH,OAAH,EAAW;AACP,qBAAKO,MAAL,CAAY,6BAAZ,EAA2CV,MAA3C;AACH,eAFD,MAEK;AACD,qBAAKU,MAAL,CAAY,6BAAZ,EAA2C,kBAA3C;AACH;AACD;AACA,mBAAKA,MAAL,CAAY,8BAAZ,EAA4C,mFAA5C;AACA,mBAAKA,MAAL,CAAY,8BAAZ,EAA4C,iCAA5C;AACA,mBAAKA,MAAL,CAAY,kCAAZ,EAAgD,MAAhD;AACA,mBAAKb,KAAL,GAAaM,OAAb;;oBACG,KAAKL,IAAL,CAAUa,MAAV,IAAoB,S;;;;;AACrB,mBAAKC,GAAL;;;;;;;;;;;;;;;;;;;EA9BuBR,MAAMS,UAAN,CAAiBC,I","file":"basemy.js","sourcesContent":["'use strict';\n\nimport {decryptCode} from '../../util.js';\n\nexport default class extends think.controller.base {\n  /**\n   * some base method in here\n   */\n  async __before() {\n    const allow = ['ymark.cc' ,'localhost' ,'liaoshane.com']\n\n    let { origin='', uk='' } = this.http.headers;\n\n    this.ip = this.http.ip();\n\n    let isAllow = false;\n    if(think.env == 'development' || uk == 'wx_xiaochengxu') isAllow = true;\n\n    for(let i=0,len=allow.length;i<len;i++){\n        if(isAllow) break;\n        if(origin && origin.indexOf(allow[i]) >= 0) isAllow = true;\n    }\n\n    if(isAllow){\n        this.header('Access-Control-Allow-Origin', origin);\n    }else{\n        this.header('Access-Control-Allow-Origin', 'ywordle.ymark.cc');\n    }\n    // this.header('Access-Control-Allow-Headers', 'Content-Type,Content-Length, Authorization, Accept,X-Requested-With ,enctype ,location');\n    this.header('Access-Control-Allow-Headers', 'Content-Type,Content-Length, Authorization, Accept,enctype ,location ,document,uk');\n    this.header('Access-Control-Allow-Methods', \"GET, POST, PUT, DELETE, OPTIONS\");\n    this.header('Access-Control-Allow-Credentials', 'true');\n    this.allow = isAllow;\n    if(this.http.method == \"OPTIONS\"){\n      this.end();\n      return;\n    }\n\n    // 1:备孕，2:孕中，3:产后\n    \n    // let ciphertext = this.cookie(\"token\");\n\n    // if(ciphertext && ciphertext != '0'){\n    //   // return this.fail(-99);\n    //     const decryptedData = decryptCode(ciphertext);\n    //     // 必须传入过期时间 和 modulename  \n    //     // 事例 \n    //     // {\n    //     //    time -> 过期时间  [后期会被用到]\n    //     //    platform -> 平台 [app.ios | app.android]\n    //     // }\n    //     if(decryptedData){\n    //         if(new Date().getTime() >= decryptedData.time){\n    //             return this.fail(-98);\n    //         }\n    //         let _userInfo = decryptedData;\n    //         this.userinfo = function(){\n    //           return _userInfo;\n    //         }\n    //         this.userid = _userInfo.u;\n    //     }\n    // }\n\n\n    // const platform = {\n    //   'app.ios'       : true,\n    //   'app.android'   : true,\n    //   'web'           : true,\n    // }\n\n    // const decryptedData = decryptCode(ciphertext);\n    // // 必须传入过期时间 和 modulename  \n    // // 事例 \n    // // {\n    // //    time -> 过期时间  [后期会被用到]\n    // //    platform -> 平台 [app.ios | app.android]\n    // // }\n    // if(!decryptedData || !decryptedData.platform || !platform[decryptedData.platform]){\n    //   return this.fail(-99);\n    // }\n\n    // if(new Date().getTime() >= decryptedData.time){\n    //   return this.fail(-98);\n    // }\n    // let _userInfo = decryptedData;\n    // this.getUser = function(){\n    //   return _userInfo;\n    // }\n\n    // this.getRids = function(){\n    //   return _userInfo.roleids;\n    // }\n\n    // this.getUserId = function(){\n    //     return _userInfo.id;\n    // }\n  }\n}"]}